"undefined"==typeof WebSocket&&(global.WebSocket=require("isomorphic-ws"));const workerMain=function(e){"use strict";const o=e.data.download,n=new WebSocket(o,"net.measurementlab.ndt.v7");let t=()=>(new Date).getTime();"undefined"!=typeof performance&&void 0!==performance.now&&(t=(()=>performance.now())),downloadTest(n,postMessage,t)},downloadTest=function(e,o,n){e.onclose=function(e){console.log(e),o({MsgType:"closed",code:e.code})},e.onerror=function(e){console.log(e)};let t=n(),s=t,a=0;e.onopen=function(){t=n(),s=t,a=0},e.onmessage=function(e){a+=void 0!==e.data.size?e.data.size:e.data.length;const r=n();r-s>250&&(o({MsgType:"measurement",ClientData:{ElapsedTime:(r-t)/1e3,NumBytes:a,MeanClientMbps:a/(r-t)*.008},Source:"client",Test:"download"}),s=r),"string"==typeof e.data&&o({MsgType:"measurement",ServerData:JSON.parse(e.data),Source:"server"})}};"undefined"!=typeof self?self.onmessage=workerMain:void 0!==this?this.onmessage=workerMain:"undefined"!=typeof onmessage&&(onmessage=workerMain);