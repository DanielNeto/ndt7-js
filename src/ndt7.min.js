!function(){"use strict";"undefined"==typeof WebSocket&&(global.WebSocket=require("isomorphic-ws")),"undefined"==typeof fetch&&(global.fetch=require("node-fetch")),"undefined"==typeof Worker&&(global.Worker=require("workerjs"));const e=function(){const e=function(e,r,t){return void 0!==r&&e in r?r[e]:void 0!==t?t:function(){}},r=function(e){throw new Error(e)},t=function(e){const r=new String(e);return{download:"wss://"+r.toLowerCase()+".medidor.rnp.br:4443/ndt/v7/download",upload:"wss://"+r.toLowerCase()+".medidor.rnp.br:4443/ndt/v7/upload"}},o=function(e){let r=0;for(let t=0;t<e.length;t++)r+=e[t];return r/e.length},n=function(e){let r=[];for(let t=1;t<e.length;t++)r.push(Math.abs(e[t]-e[t-1]));return o(r)},a=async function(e,r,t,o){let n,a;const s=[],d=new Worker(t),i=new Promise(e=>{d.resolve=function(r){d.terminate(),0==r&&(a.AllRTTs=s),e({returnCode:r,client:n,server:a})}}),l=setTimeout(()=>d.resolve(0),1e4);return d.onmessage=function(r){if(r.data&&r.data.MsgType&&"error"!==r.data.MsgType){if("measurement"==r.data.MsgType)"server"==r.data.Source?(a=r.data.ServerData,s.push(r.data.ServerData.TCPInfo.RTT)):(n=r.data.ClientData,e.measurement({Data:r.data.ClientData}));else if("closed"==r.data.MsgType)if(clearTimeout(l),1006==r.data.code){d.resolve(1);const r="The connection was closed abnormally, or could not be opened properly";e.error(r)}else d.resolve(0)}else{clearTimeout(l),d.resolve(1);const t=r.data?r.data.Error:`${o} error`;e.error(t)}},d.postMessage(r),await i};async function s(t,o,n){const s={error:e("error",t,r),measurement:e("downloadMeasurement",t)};return await a(s,o,n,"download").catch(e=>{s.error(e)})}async function d(t,o,n){const s={error:e("error",t,r),measurement:e("uploadMeasurement",t)};return await a(s,o,n,"upload").catch(e=>{s.error(e)})}return{downloadTest:s,uploadTest:d,test:async function(r,a){const i=(new Date).toLocaleString("pt-BR")+" (UTC-3)",l=t(r&&"state"in r?r.state:"rj");let u=r&&"libraryPath"in r?r.libraryPath:"";u+="ndt7-download-worker.min.js";const c=await s(a,l,u);let f={};if(f.horario=i,0!=c.returnCode)return c.returnCode;f.banda_download=8*c.client.NumBytes/c.client.ElapsedTime/1e6,f.retransmissao=c.server.TCPInfo.BytesRetrans/c.server.TCPInfo.BytesSent*100,f.ip_cliente=c.server.ConnectionInfo.Client.split(":")[0],f.ip_servidor=c.server.ConnectionInfo.Server.split(":")[0]+" ("+l.download.split("/")[2].split(":")[0]+")";let p=r&&"libraryPath"in r?r.libraryPath:"";p+="ndt7-upload-worker.min.js";const w=await d(a,l,p);if(0!=w.returnCode)return c.returnCode+(w.returnCode<<4);f.banda_upload=8*w.server.TCPInfo.BytesReceived/w.server.TCPInfo.ElapsedTime;const m=c.server.AllRTTs.concat(w.server.AllRTTs);return f.rtt=o(m)/1e3,f.jitter=n(m)/1e3,e("finalMeasurements",a)({results:f}),c.returnCode+(w.returnCode<<4)}}}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=e:window.ndt7=e}();