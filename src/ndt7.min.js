!function(){"use strict";"undefined"==typeof WebSocket&&(global.WebSocket=require("isomorphic-ws")),"undefined"==typeof fetch&&(global.fetch=require("node-fetch")),"undefined"==typeof Worker&&(global.Worker=require("workerjs"));const e=function(){const e=function(e,t,r){return void 0!==t&&e in t?t[e]:void 0!==r?r:function(){}},t=function(e){throw new Error(e)},r=function(e){const t=new String(e);return{download:"wss://"+t.toLowerCase()+".medidor.rnp.br:4443/ndt/v7/download",upload:"wss://"+t.toLowerCase()+".medidor.rnp.br:4443/ndt/v7/upload"}},o=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length},n=function(e){let t=[];for(let r=1;r<e.length;r++)t.push(Math.abs(e[r]-e[r-1]));return o(t)},a=async function(e,t,r,a){const s=(new Date).toLocaleString("pt-BR")+" (UTC-3)";let l,d;const i=[],u=new Worker(r),c=new Promise(r=>{u.resolve=function(c){u.terminate();let p={};0==c&&("download"==a?p.banda_download=8*l.NumBytes/l.ElapsedTime/1e6:"upload"==a&&(p.banda_upload=8*d.TCPInfo.BytesReceived/d.TCPInfo.ElapsedTime),p.horario=s,p.retransmissao=d.TCPInfo.BytesRetrans/d.TCPInfo.BytesSent*100,p.ip_cliente=d.ConnectionInfo.Client.split(":")[0],p.ip_servidor=d.ConnectionInfo.Server.split(":")[0]+" ("+t.download.split("/")[2].split(":")[0]+")",p.allRTTs=i,p.rtt=o(i)/1e3,p.jitter=n(i)/1e3,e.complete({results:p})),r({returnCode:c,results:p})}}),p=setTimeout(()=>u.resolve(0),1e4);return u.onmessage=function(t){if(t.data&&t.data.MsgType&&"error"!==t.data.MsgType){if("measurement"==t.data.MsgType)"server"==t.data.Source?(d=t.data.ServerData,i.push(t.data.ServerData.TCPInfo.RTT)):(l=t.data.ClientData,e.measurement({Data:t.data.ClientData}));else if("closed"==t.data.MsgType)if(clearTimeout(p),1006==t.data.code){u.resolve(1);const t="The connection was closed abnormally, or could not be opened properly";e.error(t)}else u.resolve(0)}else{clearTimeout(p),u.resolve(1);const r=t.data?t.data.Error:`${a} error`;e.error(r)}},u.postMessage(t),await c};async function s(o,n){const s={error:e("error",n,t),measurement:e("downloadMeasurement",n),complete:e("downloadComplete",n)},l=r(o&&"state"in o?o.state:"rj");let d=o&&"libraryPath"in o?o.libraryPath:"";return d+="ndt7-download-worker.min.js",await a(s,l,d,"download").catch(e=>{s.error(e)})}async function l(o,n){const s={error:e("error",n,t),measurement:e("uploadMeasurement",n),complete:e("uploadComplete",n)},l=r(o&&"state"in o?o.state:"rj");let d=o&&"libraryPath"in o?o.libraryPath:"";return d+="ndt7-upload-worker.min.js",await a(s,l,d,"upload").catch(e=>{s.error(e)})}return{downloadTest:s,uploadTest:l,test:async function(t,r){const a=await s(t,r);if(0!=a.returnCode)return a.returnCode;let d={};d.horario=a.results.horario,d.banda_download=a.results.banda_download,d.retransmissao=a.results.retransmissao,d.ip_cliente=a.results.ip_cliente,d.ip_servidor=a.results.ip_servidor;const i=await l(t,r);if(0!=i.returnCode)return a.returnCode+(i.returnCode<<4);d.banda_upload=i.results.banda_upload;const u=a.results.allRTTs.concat(i.results.allRTTs);return d.rtt=o(u)/1e3,d.jitter=n(u)/1e3,e("finalMeasurements",r)({results:d}),a.returnCode+(i.returnCode<<4)}}}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=e:window.ndt7=e}();