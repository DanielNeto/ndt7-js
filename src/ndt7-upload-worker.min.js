"undefined"==typeof WebSocket&&(global.WebSocket=require("isomorphic-ws"));const workerMain=function(e){const n=e.data.upload,o=new WebSocket(n,"net.measurementlab.ndt.v7");let t=()=>(new Date).getTime();"undefined"!=typeof performance&&void 0!==performance.now&&(t=(()=>performance.now())),uploadTest(o,postMessage,t)},uploadTest=function(e,n,o){let t=!1;e.onclose=function(e){console.log(e),t||(t=!0,n({MsgType:"closed",code:e.code}))},e.onerror=function(e){console.log(e)},e.onmessage=function(e){void 0!==e.data&&n({MsgType:"measurement",Source:"server",ServerData:JSON.parse(e.data)})},e.onopen=function(){const s=new Uint8Array(8192),r=o();!function s(r,a,i,c,u){if(t)return;const f=o();if(f>=i)return void e.close();const d=r.length>=8388608?1/0:16*r.length;u-e.bufferedAmount>=d&&(r=new Uint8Array(2*r.length));const l=7*r.length;if(e.bufferedAmount<l&&(e.send(r),u+=r.length),f>=c+250){const o=u-e.bufferedAmount,t=(f-a)/1e3;n({MsgType:"measurement",ClientData:{ElapsedTime:t,NumBytes:o,MeanClientMbps:8*o/1e6/t},Source:"client",Test:"upload"}),c=f}setTimeout(()=>s(r,a,i,c,u),0)}(s,r,r+1e4,r,0)}};"undefined"!=typeof self?self.onmessage=workerMain:void 0!==this?this.onmessage=workerMain:"undefined"!=typeof onmessage&&(onmessage=workerMain);